<!-- Font Awesome for info icon -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>

<!-- Threshold popup as table -->
<div id="threshold-popup" style="
  display: none;
  position: absolute;
  top: 80px;
  right: 60px;
  background-color: white;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  padding: 12px 16px;
  font-family: 'Segoe UI', sans-serif;
  font-size: 14px;
  z-index: 9999;
">
  <strong>Threshold Levels</strong>
  <table style="margin-top: 8px; border-collapse: collapse; width: 100%;">
    <thead>
      <tr style="background-color: #f2f2f2;">
        <th style="padding: 6px; border: 1px solid #ccc;">Type</th>
        <th style="padding: 6px; border: 1px solid #ccc;">Alarm</th>
        <th style="padding: 6px; border: 1px solid #ccc;">Alert</th>
        <th style="padding: 6px; border: 1px solid #ccc;">Warning</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding: 6px; border: 1px solid #ccc;">Air-Air</td>
        <td style="padding: 6px; border: 1px solid #ccc;">≤ 200m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">200–250m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">250–300m</td>
      </tr>
      <tr>
        <td style="padding: 6px; border: 1px solid #ccc;">Air-Ground</td>
        <td style="padding: 6px; border: 1px solid #ccc;">≤ 150m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">150–200m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">200–250m</td>
      </tr>
      <tr>
        <td style="padding: 6px; border: 1px solid #ccc;">Ground-Ground</td>
        <td style="padding: 6px; border: 1px solid #ccc;">≤ 50m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">50–80m</td>
        <td style="padding: 6px; border: 1px solid #ccc;">80–150m</td>
      </tr>
    </tbody>
  </table>
</div>

<table style="width: 100%; font-family: 'Segoe UI', sans-serif; font-size: 14px; border-collapse: collapse;">
  <thead>
    <tr style="background-color: #eab5b5;">
      <th style="padding: 8px; text-align: left;">Flight A</th>
      <th style="padding: 8px; text-align: left;">Flight B</th>
      <th style="padding: 8px; text-align: left;">Category</th>
      <th style="padding: 8px; text-align: left;">Priority</th>
      <th style="padding: 8px; text-align: left;">Distance (in meters)</th>
      <th style="padding: 2px; text-align: right;">
        <i class="fa-solid fa-circle-info" style="cursor: pointer;" onclick="showThresholdPopup()"></i>
      </th>
    </tr>
  </thead>
  <tbody id="conflict-table-body">
    <!-- Dynamic rows go here -->
  </tbody>
</table>

<script>
function showThresholdPopup() {
  const popup = document.getElementById("threshold-popup");
  popup.style.display = popup.style.display === "block" ? "none" : "block";
}

function renderConflictTable(planes) {
  const tableBody = document.getElementById("conflict-table-body");
  tableBody.innerHTML = "";

  const addedPairs = new Set();

  planes.forEach(p => {
    const flightA = p.Callsign || "Unknown";
    p.Conflicts.forEach(conflict => {
      const flightB = conflict.Callsign || "Unknown";
      const key = [flightA, flightB].sort().join("-");

      if (addedPairs.has(key)) return;
      addedPairs.add(key);

      const row = document.createElement("tr");

      // Set background color based on alert level
      let bgColor = "";
      switch (conflict.Alert) {
        case "ALARM":
          bgColor = "background-color: #f8d7da;"; break;
        case "ALERT":
          bgColor = "background-color: #ffe5b4;"; break;
        case "WARNING":
          bgColor = "background-color: #fffacc;"; break;
      }

      row.setAttribute("style", bgColor);
      row.innerHTML = `
        <td style="padding: 8px;">${flightA}</td>
        <td style="padding: 8px;">${flightB}</td>
        <td style="padding: 8px;">${conflict.Category}</td>
        <td style="padding: 8px;">${conflict.Alert}</td>
        <td style="padding: 8px;">${conflict.Distance}</td>
        <td style="padding: 8px;"></td>
      `;

      tableBody.appendChild(row);
    });
  });
}
</script>
